# 性能检测

`性能检测`该如何实现？主要分哪些部分？以什么作为标准？这里参照Google的官方文档对这些问题进行说明。

## 性能检测工具

我们通过一些工具来实现性能检测，`Android`存在多种多样的性能检测工具，这里对一些检测工具进行说明。

>  1. 手机开发者选项（小米手机开发开发者选项中名字）：调试GPU过度绘制、启用严格模式、显示CPU使用情况、GPU呈现模式分析、显示所有"应用程序无响应"。
>  2. IDE中：Android Studio，比如静态代码检测工具、Memory Monitor、CPU Monitor、NetWork Monitor、GPU Monitor、Layout Inspector、Analyze APK等。
>  3. SDK中：sdk\tools，比如DDMS、HierarchyViewer、TraceView等。
>  4. 第三方工具：MAT、LeakCanary、GT等。

## 性能问题分类

APP的性能问题主要分为以下几大类：
* 渲染问题：过度绘制、布局冗杂
* 内存问题：内存浪费（内存管理）、内存泄漏等
* 功耗问题：耗电
* 用户体验交互：网络请求耗时、应用首页启动耗时等(这个官方没有进行要求，是常见的优化中比较典型的问题)

## 性能优化指标

针对上述的几大类，对每一类的标准进行说明。

### 渲染

> 滑动流畅度：FPS，即Frame per Second，一秒内的刷新帧数，越接近60帧越好；

> 过度绘制：单页面的3X（粉红色区域） Overdraw小于25%
  
> 启动时间：这里主要说的是Activity界面启动时间，一般低于300ms，需要用高频摄像机计算时间。

### 内存

> 内存大小：峰值越低越好，需要优化前后做对比

> 内存泄漏：需要用工具检查对比优化前后

### 功耗

> 单位时间内的掉电量，掉电量越少越好，业内没有固定标准。

### 用户体验交互

这部分是常见的典型部分，却不处于以上三大类的问题。

> 网络请求耗时,一般要求2s之内对app的请求进行处理。特殊请求，可以增加到5-8s。

> 首页启动，一般来说大部分app都需要达到1s内，初次点击桌面图标启动app就可以看到app的Launch页面。

## 性能优化原则和方法

如何才能快速提升自己APP的体验，我们要做到坚持性能测试，不要凭感觉去检测性能问题、评估性能优化的效果，应该保持足够多的测量，用数据说话,使用各种性能工具测试及快速定位问题。

测试时使用低配置的设备。同样的程序，在低端配置的设备中，相同的问题会暴露得更为明显。

> 更需要注意的是，一定要权衡利弊。在能够保证产品稳定、按时完成需求的前提下去做优化，每一个优化点可能提升不是很大却会很耗时。



